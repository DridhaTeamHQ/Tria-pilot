/**
 * ANCHOR_CORE - Identity-Preserving Compositional Rendering (IPCR-X)
 * 
 * This is the SHARED, MODEL-AGNOSTIC core that runs BEFORE any FLASH or PRO logic.
 * FLASH and PRO must NEVER bypass this core.
 * 
 * ABSOLUTE RULE: Identity preservation > aesthetics
 * If realism conflicts with beauty, realism wins.
 */

import 'server-only'

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANCHOR_CORE STRUCTURE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface AnchorCore {
   bodyPreservationAbsolute: string
   faceAnchor: string
   bodyAnchor: string
   hairAnchor: string
   faceBodyTransition: string
   clothingIsolation: string
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜…â˜…â˜… BODY PRESERVATION ABSOLUTE - HIGHEST PRIORITY â˜…â˜…â˜…
// This MUST be the FIRST thing the model reads
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const BODY_PRESERVATION_ABSOLUTE = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â˜…â˜…â˜…â˜…â˜… BODY PRESERVATION ABSOLUTE - HIGHEST PRIORITY â˜…â˜…â˜…â˜…â˜…                     â•‘
â•‘                      READ THIS FIRST BEFORE ANYTHING ELSE                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸âš ï¸âš ï¸ EMERGENCY INSTRUCTION âš ï¸âš ï¸âš ï¸

THE PERSON'S BODY IN IMAGE 1 IS THE **ONLY** BODY SOURCE.
THE MODEL WEARING THE CLOTHING IN IMAGE 2 IS **NOT** THE SUBJECT.

DO NOT MAKE THE PERSON THINNER.
DO NOT MAKE THE PERSON THINNER.
DO NOT MAKE THE PERSON THINNER.
DO NOT MAKE THE PERSON THINNER.
DO NOT MAKE THE PERSON THINNER.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜…â˜…â˜… BODY WEIGHT CONFIGURATION (CRITICAL) â˜…â˜…â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: ANALYZE IMAGE 1 BODY TYPE
Look at Image 1 and identify the person's body type:
â–¡ Is the person PLUS-SIZE / OVERWEIGHT / FAT? â†’ OUTPUT MUST BE PLUS-SIZE / OVERWEIGHT / FAT
â–¡ Is the person CURVY / HEAVY-SET? â†’ OUTPUT MUST BE CURVY / HEAVY-SET
â–¡ Is the person AVERAGE BUILD? â†’ OUTPUT MUST BE AVERAGE BUILD
â–¡ Is the person THIN / SLIM? â†’ OUTPUT MUST BE THIN / SLIM

STEP 2: PRESERVE BODY VOLUME
The OUTPUT body must have the SAME VOLUME as Image 1:
â€¢ Same WIDTH at shoulders
â€¢ Same WIDTH at waist
â€¢ Same WIDTH at hips
â€¢ Same ROUNDNESS at belly
â€¢ Same THICKNESS at arms
â€¢ Same FULLNESS at cheeks/face

STEP 3: APPLY CLOTHING TO ACTUAL BODY
The dress/shirt/clothing from Image 2 must be applied to the 
EXACT body from Image 1 - stretched or fitted as needed.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BODY SIZE DESCRIPTORS - PRESERVE EXACTLY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IF PERSON IN IMAGE 1 HAS:
â€¢ WIDE shoulders â†’ OUTPUT has WIDE shoulders
â€¢ THICK arms â†’ OUTPUT has THICK arms
â€¢ LARGE bust/chest â†’ OUTPUT has LARGE bust/chest
â€¢ ROUND belly â†’ OUTPUT has ROUND belly
â€¢ WIDE waist â†’ OUTPUT has WIDE waist
â€¢ WIDE hips â†’ OUTPUT has WIDE hips
â€¢ THICK thighs â†’ OUTPUT has THICK thighs
â€¢ DOUBLE chin â†’ OUTPUT has DOUBLE chin
â€¢ FULL cheeks â†’ OUTPUT has FULL cheeks

DO NOT:
â€¢ Slim the waist
â€¢ Narrow the hips
â€¢ Flatten the belly
â€¢ Thin the arms
â€¢ Remove the double chin
â€¢ Reduce cheek fullness

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BODY PRESERVATION RULES (NON-NEGOTIABLE):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. If Image 1 shows a FAT person â†’ OUTPUT shows a FAT person
2. If Image 1 shows a THIN person â†’ OUTPUT shows a THIN person
3. If Image 1 shows a CURVY person â†’ OUTPUT shows a CURVY person
4. If Image 1 shows a MUSCULAR person â†’ OUTPUT shows a MUSCULAR person
5. If Image 1 shows an OVERWEIGHT person â†’ OUTPUT shows an OVERWEIGHT person
6. If Image 1 shows a PLUS-SIZE person â†’ OUTPUT shows a PLUS-SIZE person

THE CLOTHING MODEL'S BODY IS IRRELEVANT.
THE CLOTHING MODEL'S BODY IS IRRELEVANT.
THE CLOTHING MODEL'S BODY IS IRRELEVANT.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SPECIFIC MEASUREMENTS (COPY EXACTLY FROM IMAGE 1):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ SHOULDER WIDTH â†’ Copy exactly from Image 1
â€¢ ARM THICKNESS â†’ Copy exactly from Image 1
â€¢ ARM CIRCUMFERENCE â†’ Copy exactly from Image 1
â€¢ CHEST SIZE â†’ Copy exactly from Image 1
â€¢ WAIST WIDTH â†’ Copy exactly from Image 1 (DO NOT SLIM)
â€¢ WAIST CIRCUMFERENCE â†’ Copy exactly from Image 1 (DO NOT REDUCE)
â€¢ HIP WIDTH â†’ Copy exactly from Image 1 (DO NOT NARROW)
â€¢ BELLY SIZE â†’ Copy exactly from Image 1 (DO NOT REDUCE)
â€¢ BELLY ROUNDNESS â†’ Copy exactly from Image 1 (DO NOT FLATTEN)
â€¢ THIGH THICKNESS â†’ Copy exactly from Image 1
â€¢ OVERALL BODY VOLUME â†’ Copy exactly from Image 1
â€¢ OVERALL BODY MASS â†’ Copy exactly from Image 1

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMAGE 2 CONTAINS CLOTHING ONLY - NOT A BODY REFERENCE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
From Image 2 (clothing reference), extract ONLY:
âœ“ The COLOR of the garment
âœ“ The FABRIC of the garment
âœ“ The STYLE of the garment
âœ“ The PATTERN of the garment

From Image 2, COMPLETELY IGNORE:
âœ— The model's body shape
âœ— The model's body size
âœ— The model's body weight
âœ— The model's proportions
âœ— How the clothing fits on that model
âœ— How tight/loose it is on that model
âœ— The model's waist size
âœ— The model's hip size

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜…â˜…â˜… HALLUCINATION WARNING â˜…â˜…â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The AI has a BIAS toward generating thin bodies.
This is a KNOWN PROBLEM that must be actively FOUGHT AGAINST.

When you generate the output:
â€¢ ACTIVELY CHECK: "Did I make the person thinner?"
â€¢ If YES â†’ YOU FAILED â†’ The output is WRONG
â€¢ The clothing model being thin does NOT mean the subject is thin

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IF YOU MAKE THE PERSON THINNER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜… THE GENERATION HAS FAILED â˜…
â˜… THIS IS THE WORST POSSIBLE ERROR â˜…
â˜… THIS IS BODY SHAMING â˜…
â˜… THIS IS UNACCEPTABLE â˜…

The person in Image 1 is EXACTLY who they are.
Their body is BEAUTIFUL as it is.
You do NOT get to change their body.
You are ONLY changing their clothes.

A PLUS-SIZE person wearing a dress is STILL a PLUS-SIZE person.
A FAT person in new clothes is STILL a FAT person.
The clothing does NOT change body size.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FACE ANCHOR - Face geometry is READ-ONLY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const FACE_ANCHOR = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         FACE ANCHOR (IMMUTABLE)                               â•‘
â•‘                    The face in Image 1 defines identity                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOCK ALL FACIAL GEOMETRY FROM IMAGE 1:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Eye SIZE â†’ LOCKED (exact pixel dimensions)
â€¢ Eye SPACING â†’ LOCKED (distance between eyes)
â€¢ Eye TILT â†’ LOCKED (angle of eye corners)
â€¢ Eye OPENNESS â†’ LOCKED (lid position)
â€¢ Nose WIDTH â†’ LOCKED
â€¢ Nose LENGTH â†’ LOCKED
â€¢ Nose BRIDGE SHAPE â†’ LOCKED
â€¢ Mouth WIDTH â†’ LOCKED
â€¢ Lip THICKNESS â†’ LOCKED
â€¢ Jaw WIDTH â†’ LOCKED
â€¢ Chin SHAPE â†’ LOCKED
â€¢ Cheek FULLNESS â†’ LOCKED
â€¢ Facial ASYMMETRY â†’ PRESERVED (do not symmetrize)
â€¢ Skin TONE â†’ LOCKED (exact color)
â€¢ Skin UNDERTONE â†’ LOCKED
â€¢ Skin TEXTURE â†’ LOCKED
â€¢ PORES â†’ PRESERVED
â€¢ WRINKLES â†’ PRESERVED
â€¢ SCARS â†’ PRESERVED
â€¢ MOLES â†’ PRESERVED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ABSOLUTELY PROHIBITED (ZERO TOLERANCE):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ— Eye shrinking
âœ— Eye enlargement
âœ— Eye shape modification
âœ— Facial slimming
âœ— Jaw refinement
âœ— Nose reduction
âœ— Lip enhancement
âœ— Symmetry enforcement
âœ— Beauty enhancement
âœ— Skin smoothing
âœ— Pore removal
âœ— Wrinkle reduction
âœ— "Attractiveness optimization"
âœ— Age modification
âœ— Expression changes (unless requested)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CORE PRINCIPLE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The face is a READ-ONLY identity reference.
Family-recognition accuracy > visual perfection.
If their mother wouldn't recognize them, the generation FAILED.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BODY ANCHOR - Body proportions are canonical
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const BODY_ANCHOR = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         BODY ANCHOR (IMMUTABLE)                               â•‘
â•‘                    The body in Image 1 is canonical                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOCK BODY PROPORTIONS FROM IMAGE 1:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Shoulder WIDTH â†’ LOCKED (exact measurement)
â€¢ Arm THICKNESS â†’ LOCKED (both arms)
â€¢ Chest VOLUME â†’ LOCKED
â€¢ Chest DEPTH â†’ LOCKED
â€¢ Waist WIDTH â†’ LOCKED
â€¢ Hip RATIO â†’ LOCKED
â€¢ Belly VOLUME â†’ LOCKED (if present, keep exactly)
â€¢ Torso LENGTH â†’ LOCKED
â€¢ Neck THICKNESS â†’ LOCKED
â€¢ Neck LENGTH â†’ LOCKED
â€¢ Posture â†’ PRESERVED (including imperfections)
â€¢ Body ASYMMETRY â†’ PRESERVED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FUNDAMENTAL RULE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜… CLOTHING ADAPTS TO THE BODY â˜…
â˜… THE BODY NEVER ADAPTS TO CLOTHING â˜…

The clothing reference shows fabric, color, and style.
The BODY determines how that clothing fits.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ABSOLUTELY PROHIBITED (ZERO TOLERANCE):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ— Slimming waist
âœ— Reducing belly
âœ— Narrowing hips
âœ— Slimming thighs
âœ— Thinning arms
âœ— Lengthening limbs
âœ— Straightening posture
âœ— Normalizing proportions
âœ— Fitness bias
âœ— "Flattering" adjustments
âœ— "Photogenic" modifications
âœ— Body type preference

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DEMOGRAPHIC SAFETY (MANDATORY):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
This must work EQUALLY for:
â€¢ Fat bodies â†’ preserve exactly
â€¢ Thin bodies â†’ preserve exactly
â€¢ Muscular bodies â†’ preserve exactly
â€¢ Short bodies â†’ preserve exactly
â€¢ Tall bodies â†’ preserve exactly
â€¢ Curvy bodies â†’ preserve exactly
â€¢ Athletic bodies â†’ preserve exactly
â€¢ Aging bodies â†’ preserve exactly

NO body type is "more correct" than another.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HAIR ANCHOR - Hair is identity-critical
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const HAIR_ANCHOR = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         HAIR ANCHOR (IMMUTABLE)                               â•‘
â•‘                       Hair is identity-critical                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOCK FROM IMAGE 1:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Hairline SHAPE â†’ LOCKED
â€¢ Hairline POSITION â†’ LOCKED
â€¢ Hair DENSITY â†’ LOCKED
â€¢ Hair VOLUME â†’ LOCKED
â€¢ Hair THICKNESS (strand) â†’ LOCKED
â€¢ Curl PATTERN â†’ LOCKED
â€¢ Wave PATTERN â†’ LOCKED
â€¢ Parting DIRECTION â†’ LOCKED
â€¢ Parting POSITION â†’ LOCKED
â€¢ Flyaways â†’ PRESERVED
â€¢ Irregularity â†’ PRESERVED
â€¢ Gray hairs â†’ PRESERVED
â€¢ Thinning areas â†’ PRESERVED
â€¢ Receding areas â†’ PRESERVED

FOR BEARDS/FACIAL HAIR:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Beard SHAPE â†’ LOCKED
â€¢ Beard DENSITY â†’ LOCKED
â€¢ Stubble PATTERN â†’ LOCKED
â€¢ Mustache STYLE â†’ LOCKED
â€¢ Sideburn LENGTH â†’ LOCKED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ABSOLUTELY PROHIBITED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ— Thickening hair
âœ— Thinning hair
âœ— Restyling hair
âœ— "Cleaning up" flyaways
âœ— Adjusting volume
âœ— Moving hairline
âœ— Adding hair where thin
âœ— Removing gray/white
âœ— Changing texture
âœ— Grooming beard
âœ— Trimming edges
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FACE-BODY TRANSITION - Eliminates pasted-face artifacts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const FACE_BODY_TRANSITION = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    FACE-BODY TRANSITION (CONTINUITY)                          â•‘
â•‘                   â˜…â˜…â˜… CRITICAL: ELIMINATES PASTED-FACE â˜…â˜…â˜…                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜…â˜…â˜… THIS IS THE #1 PRIORITY FOR REALISM â˜…â˜…â˜…

The most common failure is "pasted face" - where the face looks composited.
This MUST be avoided at all costs.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NECK BLENDING ZONE (CRITICAL):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The NECK is the transition zone between face and body.
This zone MUST be rendered with extreme care:

NECK REQUIREMENTS:
â€¢ Neck skin TONE must EXACTLY match face skin tone
â€¢ Neck skin TEXTURE must match face skin texture
â€¢ Neck THICKNESS from Image 1 preserved exactly
â€¢ Neck LENGTH from Image 1 preserved exactly
â€¢ NO visible seam line at jaw/neck junction
â€¢ NO color difference between chin underside and neck
â€¢ NO different lighting on neck vs face

JAWLINE TRANSITION:
â€¢ The area under the chin â†’ neck front must be ONE surface
â€¢ Shadow under jaw must continue naturally to neck
â€¢ Skin color must be identical from chin to neck
â€¢ NO "mask edge" appearance at jawline

COLLAR TRANSITION:
â€¢ Where clothing meets skin must look natural
â€¢ Skin exposed above collar must match face exactly
â€¢ NO different skin tone on chest/shoulders vs face

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SKIN CONTINUITY (TECHNICAL REQUIREMENTS):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ HSL values must be continuous from face â†’ neck â†’ chest
â€¢ Color temperature must be identical
â€¢ If face has warm undertone â†’ neck has warm undertone
â€¢ If face has texture â†’ neck has same texture quality
â€¢ If face has pores visible â†’ neck has pores visible
â€¢ If face shows veins â†’ neck may show veins
â€¢ Skin luminosity must match
â€¢ NO "porcelain neck" if face has texture
â€¢ NO "smooth neck" if face has detail

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LIGHTING CONTINUITY (TECHNICAL REQUIREMENTS):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ Light SOURCE affects face and body identically
â€¢ Shadow DIRECTION consistent across entire body
â€¢ Light FALLOFF is smooth (no sudden changes)
â€¢ Specular HIGHLIGHTS consistent
â€¢ If key light from left â†’ left side of face AND body lit
â€¢ If shadow under nose â†’ shadow under chin continues to neck
â€¢ NO "face lit differently than body"
â€¢ NO "studio lighting on face, natural on body"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DO NOT DO THIS (COMMON FAILURES):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ— Face brighter than neck â†’ PASTED LOOK
âœ— Face warmer than neck â†’ PASTED LOOK
âœ— Face sharper than neck â†’ PASTED LOOK
âœ— Face smoother than neck â†’ PASTED LOOK
âœ— Different light direction on face â†’ PASTED LOOK
âœ— Visible line at jaw â†’ PASTED LOOK
âœ— Neck skin tone different â†’ PASTED LOOK

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICATION CHECK:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Before finalizing, verify:
â–¡ Can you see where the face "ends" and body "begins"?
  â†’ If YES â†’ FAILED (redo with better blending)
  â†’ If NO â†’ PASSED

The result must look like ONE photograph taken with ONE camera.
Not a collage. Not composited. Not edited.

If it looks like "face pasted onto body" â†’ GENERATION FAILED â†’ REDO.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOTHING ISOLATION - Stops body bleed from reference
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const CLOTHING_ISOLATION = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      CLOTHING ISOLATION (REFERENCE)                           â•‘
â•‘    â˜…â˜…â˜… CRITICAL: BODY FROM CLOTHING REFERENCE MUST BE COMPLETELY IGNORED â˜…â˜…â˜… â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜…â˜…â˜… THIS IS A MAJOR SOURCE OF IDENTITY FAILURE â˜…â˜…â˜…

The clothing reference image (Image 2) shows a DIFFERENT person wearing the garment.
That person's body MUST NOT affect the output in ANY way.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WHAT TO EXTRACT FROM CLOTHING REFERENCE (IMAGE 2):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ONLY extract these properties from the clothing reference:
âœ“ Fabric TEXTURE (cotton, silk, linen, etc.)
âœ“ Fabric WEAVE pattern
âœ“ Fabric WEIGHT appearance (how it hangs)
âœ“ Stitching STYLE and quality
âœ“ Seam PLACEMENT
âœ“ Button/closure STYLE
âœ“ Collar SHAPE and construction
âœ“ Sleeve CUT and style
âœ“ Overall garment SILHOUETTE design
âœ“ Exact COLOR (match precisely)
âœ“ Pattern/print DESIGN
âœ“ Hem style
âœ“ Pocket placement and style

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜…â˜…â˜… COMPLETELY BLOCK FROM CLOTHING REFERENCE â˜…â˜…â˜…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
The following MUST NOT transfer from clothing reference to output:

ğŸš« MODEL'S BODY TYPE â†’ BLOCKED
   The thin model in the clothing photo does NOT make subject thinner
   
ğŸš« MODEL'S BODY PROPORTIONS â†’ BLOCKED
   The model's waist-to-hip ratio is IRRELEVANT
   
ğŸš« MODEL'S SHOULDER WIDTH â†’ BLOCKED
   The model's narrow shoulders don't shrink subject's shoulders
   
ğŸš« MODEL'S POSE â†’ BLOCKED
   How the model stands is IRRELEVANT
   
ğŸš« MODEL'S POSTURE â†’ BLOCKED
   The model's straight posture doesn't change subject's posture
   
ğŸš« HOW CLOTHING FITS ON MODEL â†’ BLOCKED
   The tight fit on slim model doesn't make it tight on subject
   
ğŸš« HOW CLOTHING DRAPES ON MODEL â†’ BLOCKED
   Draping is recalculated for SUBJECT'S body

ğŸš« MODEL'S SKIN TONE â†’ BLOCKED
ğŸš« MODEL'S FACE â†’ BLOCKED
ğŸš« MODEL'S HANDS â†’ BLOCKED
ğŸš« MODEL'S LEGS â†’ BLOCKED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BODY SEGREGATION RULE (FUNDAMENTAL):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BODY SOURCE: Image 1 ONLY (the subject)
CLOTHING SOURCE: Image 2 ONLY (just the garment, not the body wearing it)

The clothing must be MENTALLY EXTRACTED from Image 2 and 
RE-FITTED to the body from Image 1.

Think of it as:
1. "See" only the garment in Image 2 (ignore the body completely)
2. Apply that garment to the body from Image 1
3. Calculate new draping based on Image 1 body physics

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RE-FITTING PHYSICS (MANDATORY):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When applying clothing from Image 2 to body from Image 1:

IF subject has WIDER shoulders than clothing model:
â†’ Clothing stretches at shoulders
â†’ Fabric tension increases
â†’ Sleeve position shifts outward

IF subject has LARGER chest than clothing model:
â†’ Clothing stretches across chest
â†’ Buttons show tension (if applicable)
â†’ Fabric pulls across bust/chest

IF subject has LARGER belly than clothing model:
â†’ Clothing drapes over belly
â†’ Front of garment extends further out
â†’ Side seams curve around torso

IF subject has WIDER hips than clothing model:
â†’ Skirt/pants drape over hips
â†’ Fabric falls from widest point
â†’ More volume in hip area

IF subject has THICKER arms than clothing model:
â†’ Sleeves fit snugger
â†’ Fabric wraps around arms
â†’ Less excess fabric

THE CLOTHING ADAPTS. THE BODY NEVER CHANGES.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FAILURE CONDITIONS (BODY BLEED DETECTION):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
If any of these happen, the generation FAILED:

âœ— Subject looks thinner than in Image 1 â†’ BODY BLEED â†’ FAILED
âœ— Subject looks taller than in Image 1 â†’ BODY BLEED â†’ FAILED
âœ— Subject's shoulders narrower than Image 1 â†’ BODY BLEED â†’ FAILED
âœ— Subject's waist smaller than Image 1 â†’ BODY BLEED â†’ FAILED
âœ— Subject's pose changed to match model â†’ BODY BLEED â†’ FAILED
âœ— Subject's posture "improved" â†’ BODY BLEED â†’ FAILED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICATION CHECK:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Compare output body to Image 1 body:
â–¡ Same shoulder width? 
â–¡ Same arm thickness?
â–¡ Same chest volume?
â–¡ Same waist width?
â–¡ Same hip width?
â–¡ Same posture (including slouch)?
â–¡ Same body proportions?

If ANY answer is NO â†’ BODY BLEED DETECTED â†’ GENERATION FAILED.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANTI-BIAS ENFORCEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const ANTI_BIAS_ENFORCEMENT = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ANTI-BIAS ENFORCEMENT (MANDATORY)                        â•‘
â•‘                        No beautification bias allowed                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

THIS SYSTEM MUST WORK RELIABLY FOR ALL PEOPLE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

GENDER:
â€¢ Men â†’ preserve exactly
â€¢ Women â†’ preserve exactly (NO drift toward "prettier")
â€¢ Non-binary â†’ preserve exactly

BODY TYPE:
â€¢ Fat â†’ preserve exactly (NO slimming)
â€¢ Thin â†’ preserve exactly (NO filling out)
â€¢ Muscular â†’ preserve exactly
â€¢ Average â†’ preserve exactly

SKIN TONE:
â€¢ Black skin â†’ preserve exactly (NO lightening)
â€¢ Brown skin â†’ preserve exactly
â€¢ Asian skin â†’ preserve exactly
â€¢ White skin â†’ preserve exactly
â€¢ Mixed â†’ preserve exactly

FACE CHARACTERISTICS:
â€¢ Tilted faces â†’ preserve angle
â€¢ Asymmetric faces â†’ preserve asymmetry
â€¢ Expressions â†’ preserve exactly
â€¢ Real imperfections â†’ preserve all

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BIAS DETECTION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
If the AI is making someone:
â€¢ Thinner â†’ BIAS DETECTED â†’ REJECT
â€¢ Lighter skinned â†’ BIAS DETECTED â†’ REJECT
â€¢ More symmetrical â†’ BIAS DETECTED â†’ REJECT
â€¢ "Prettier" â†’ BIAS DETECTED â†’ REJECT
â€¢ More "flattering" â†’ BIAS DETECTED â†’ REJECT

The input is the truth.
The AI does not get to "improve" anyone.
`

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUILD COMPLETE ANCHOR CORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function buildAnchorCore(): AnchorCore {
   return {
      bodyPreservationAbsolute: BODY_PRESERVATION_ABSOLUTE,
      faceAnchor: FACE_ANCHOR,
      bodyAnchor: BODY_ANCHOR,
      hairAnchor: HAIR_ANCHOR,
      faceBodyTransition: FACE_BODY_TRANSITION,
      clothingIsolation: CLOTHING_ISOLATION
   }
}

export function getAnchorCorePrompt(): string {
   // BODY_PRESERVATION_ABSOLUTE must be FIRST - highest priority
   return `
${BODY_PRESERVATION_ABSOLUTE}

${FACE_ANCHOR}

${BODY_ANCHOR}

${HAIR_ANCHOR}

${FACE_BODY_TRANSITION}

${CLOTHING_ISOLATION}

${ANTI_BIAS_ENFORCEMENT}
`
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGGING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export function logAnchorCoreStatus(sessionId: string): void {
   console.log(`\nğŸ”’ ANCHOR_CORE ACTIVE [${sessionId}]`)
   console.log(`   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`)
   console.log(`   âœ“ FACE_ANCHOR: Geometry locked`)
   console.log(`   âœ“ BODY_ANCHOR: Proportions locked`)
   console.log(`   âœ“ HAIR_ANCHOR: Identity locked`)
   console.log(`   âœ“ FACE_BODY_TRANSITION: Continuity enforced`)
   console.log(`   âœ“ CLOTHING_ISOLATION: Reference isolated`)
   console.log(`   âœ“ ANTI_BIAS_ENFORCEMENT: Active`)
   console.log(`   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`)
}
